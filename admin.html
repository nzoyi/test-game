<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GalacticByte Studio - API Key Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#4f46e5",
              secondary: "#10b981",
              dark: "#1e293b",
              light: "#f8fafc",
              danger: "#ef4444",
              warning: "#f59e0b",
            },
          },
        },
      };
    </script>
    <style>
      .sidebar {
        transition: all 0.3s ease;
      }
      .sidebar.collapsed {
        width: 80px;
      }
      .sidebar.collapsed .sidebar-text {
        display: none;
      }
      .sidebar.collapsed .logo-text {
        display: none;
      }
      .sidebar.collapsed .logo-icon {
        display: block;
      }
      .logo-icon {
        display: none;
      }
      .content {
        transition: all 0.3s ease;
      }
      .sidebar.collapsed + .content {
        margin-left: 80px;
      }
      .loading-spinner {
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <div class="flex h-screen overflow-hidden">
      <!-- Sidebar -->
      <div
        class="sidebar bg-dark text-white w-64 flex flex-col fixed h-full z-50"
      >
        <!-- Logo -->
        <div
          class="p-4 flex items-center justify-between border-b border-gray-700"
        >
          <div class="flex items-center space-x-2">
            <i class="fas fa-gamepad text-2xl text-primary logo-icon"></i>
            <span class="text-xl font-bold logo-text">GalacticByte Studio</span>
          </div>
          <button id="toggleSidebar" class="text-gray-400 hover:text-white">
            <i class="fas fa-bars"></i>
          </button>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 overflow-y-auto py-4">
          <div class="px-4 space-y-2">
            <a
              href="#"
              class="flex items-center space-x-3 px-3 py-2 rounded-md bg-primary text-white"
            >
              <i class="fas fa-key"></i>
              <span class="sidebar-text">API Keys</span>
            </a>
            <a
              href="#"
              class="flex items-center space-x-3 px-3 py-2 rounded-md text-gray-300 hover:bg-gray-700 hover:text-white"
            >
              <i class="fas fa-chart-line"></i>
              <span class="sidebar-text">Analytics</span>
            </a>
            <a
              href="#"
              class="flex items-center space-x-3 px-3 py-2 rounded-md text-gray-300 hover:bg-gray-700 hover:text-white"
            >
              <i class="fas fa-users"></i>
              <span class="sidebar-text">Clients</span>
            </a>
            <a
              href="#"
              class="flex items-center space-x-3 px-3 py-2 rounded-md text-gray-300 hover:bg-gray-700 hover:text-white"
            >
              <i class="fas fa-cog"></i>
              <span class="sidebar-text">Settings</span>
            </a>
          </div>

          <div class="px-4 mt-8">
            <h3
              class="px-3 text-xs uppercase font-semibold text-gray-400 sidebar-text"
            >
              Support
            </h3>
            <div class="mt-2 space-y-2">
              <a
                href="#"
                class="flex items-center space-x-3 px-3 py-2 rounded-md text-gray-300 hover:bg-gray-700 hover:text-white"
              >
                <i class="fas fa-question-circle"></i>
                <span class="sidebar-text">Help Center</span>
              </a>
              <a
                href="#"
                class="flex items-center space-x-3 px-3 py-2 rounded-md text-gray-300 hover:bg-gray-700 hover:text-white"
              >
                <i class="fas fa-envelope"></i>
                <span class="sidebar-text">Contact Support</span>
              </a>
            </div>
          </div>
        </nav>

        <!-- User Profile -->
        <div class="p-4 border-t border-gray-700">
          <div class="flex items-center space-x-3">
            <img
              src="https://randomuser.me/api/portraits/men/32.jpg"
              alt="User"
              class="w-10 h-10 rounded-full"
            />
            <div class="sidebar-text">
              <p class="font-medium">Admin User</p>
              <p class="text-sm text-gray-400">admin@galacticbytestudio.com</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="content flex-1 flex flex-col ml-64">
        <!-- Top Navigation -->
        <header class="bg-white shadow-sm z-40">
          <div class="flex items-center justify-between px-6 py-4">
            <h1 class="text-2xl font-bold text-gray-800">API Key Management</h1>
            <div class="flex items-center space-x-4">
              <div class="relative">
                <input
                  type="text"
                  placeholder="Search..."
                  class="pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                />
                <i
                  class="fas fa-search absolute left-3 top-3 text-gray-400"
                ></i>
              </div>
              <button
                class="p-2 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200"
              >
                <i class="fas fa-bell"></i>
              </button>
            </div>
          </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto p-6 bg-gray-50">
          <!-- Stats Cards -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            <div class="bg-white rounded-lg shadow p-6">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500">Total API Keys</p>
                  <h3 class="text-2xl font-bold" id="totalKeys">0</h3>
                </div>
                <div class="p-3 rounded-full bg-blue-100 text-primary">
                  <i class="fas fa-key text-xl"></i>
                </div>
              </div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500">Active Keys</p>
                  <h3 class="text-2xl font-bold" id="activeKeys">0</h3>
                </div>
                <div class="p-3 rounded-full bg-green-100 text-secondary">
                  <i class="fas fa-check-circle text-xl"></i>
                </div>
              </div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500">Suspended Keys</p>
                  <h3 class="text-2xl font-bold" id="suspendedKeys">0</h3>
                </div>
                <div class="p-3 rounded-full bg-yellow-100 text-warning">
                  <i class="fas fa-exclamation-triangle text-xl"></i>
                </div>
              </div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500">API Requests Today</p>
                  <h3 class="text-2xl font-bold" id="totalRequests">0</h3>
                </div>
                <div class="p-3 rounded-full bg-purple-100 text-indigo-500">
                  <i class="fas fa-exchange-alt text-xl"></i>
                </div>
              </div>
            </div>
          </div>

          <!-- API Keys Table -->
          <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
            <div class="flex items-center justify-between px-6 py-4 border-b">
              <h2 class="text-lg font-semibold">API Keys</h2>
              <button
                id="addKeyBtn"
                class="bg-primary hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
              >
                <i class="fas fa-plus"></i>
                <span>Add New Key</span>
              </button>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Key ID
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Client
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      API Key
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Status
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Created
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Usage
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody
                  id="apiKeysTable"
                  class="bg-white divide-y divide-gray-200"
                >
                  <!-- Data will be loaded here -->
                  <tr>
                    <td colspan="7" class="px-6 py-4 text-center">
                      <div
                        class="flex justify-center items-center space-x-2 text-gray-500"
                      >
                        <i class="fas fa-circle-notch loading-spinner"></i>
                        <span>Loading API keys...</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="px-6 py-4 border-t flex items-center justify-between">
              <div class="text-sm text-gray-500">
                Showing <span id="startItem">0</span> to
                <span id="endItem">0</span> of
                <span id="totalItems">0</span> entries
              </div>
              <div class="flex space-x-2">
                <button
                  id="prevPage"
                  class="px-3 py-1 border rounded text-gray-600 hover:bg-gray-100 disabled:opacity-50"
                  disabled
                >
                  Previous
                </button>
                <button
                  id="nextPage"
                  class="px-3 py-1 border rounded text-gray-600 hover:bg-gray-100 disabled:opacity-50"
                  disabled
                >
                  Next
                </button>
              </div>
            </div>
          </div>

          <!-- Usage Analytics -->
          <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="flex items-center justify-between px-6 py-4 border-b">
              <h2 class="text-lg font-semibold">API Usage Analytics</h2>
              <div class="flex items-center space-x-2">
                <select
                  id="timeRange"
                  class="border rounded-lg px-3 py-1 focus:outline-none focus:ring-2 focus:ring-primary"
                >
                  <option value="7">Last 7 Days</option>
                  <option value="30" selected>Last 30 Days</option>
                  <option value="90">Last 90 Days</option>
                </select>
              </div>
            </div>
            <div class="p-6">
              <div class="h-80">
                <canvas id="usageChart"></canvas>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Add/Edit API Key Modal -->
    <div
      id="apiKeyModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
      <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
        <div class="px-6 py-4 border-b flex items-center justify-between">
          <h3 class="text-lg font-semibold" id="modalTitle">Add New API Key</h3>
          <button id="closeModal" class="text-gray-400 hover:text-gray-500">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="apiKeyForm" class="p-6">
          <input type="hidden" id="keyId" />
          <div class="mb-4">
            <label
              for="clientName"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Client Name</label
            >
            <input
              type="text"
              id="clientName"
              class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
              required
            />
          </div>
          <div class="mb-4">
            <label
              for="clientEmail"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Client Email</label
            >
            <input
              type="email"
              id="clientEmail"
              class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
              required
            />
          </div>
          <div class="mb-4">
            <label
              for="keyStatus"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Status</label
            >
            <select
              id="keyStatus"
              class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            >
              <option value="active">Active</option>
              <option value="suspended">Suspended</option>
            </select>
          </div>
          <div class="mb-4" id="apiKeyField">
            <label
              for="apiKey"
              class="block text-sm font-medium text-gray-700 mb-1"
              >API Key</label
            >
            <div class="flex items-center">
              <input
                type="text"
                id="apiKey"
                class="flex-1 px-3 py-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                readonly
              />
              <button
                type="button"
                id="copyKey"
                class="px-3 py-2 bg-gray-100 border border-l-0 rounded-r-lg hover:bg-gray-200"
              >
                <i class="fas fa-copy"></i>
              </button>
            </div>
            <p class="text-xs text-gray-500 mt-1">
              This key will be generated automatically
            </p>
          </div>
          <div class="flex justify-end space-x-3 mt-6">
            <button
              type="button"
              id="cancelBtn"
              class="px-4 py-2 border rounded-lg text-gray-700 hover:bg-gray-100"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-primary hover:bg-indigo-700 text-white rounded-lg"
            >
              <span id="submitBtnText">Add Key</span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div
      id="deleteModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
      <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
        <div class="px-6 py-4 border-b flex items-center justify-between">
          <h3 class="text-lg font-semibold">Confirm Deletion</h3>
          <button
            id="closeDeleteModal"
            class="text-gray-400 hover:text-gray-500"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="p-6">
          <p class="text-gray-700 mb-6">
            Are you sure you want to delete this API key? This action cannot be
            undone.
          </p>
          <div class="flex justify-end space-x-3">
            <button
              type="button"
              id="cancelDeleteBtn"
              class="px-4 py-2 border rounded-lg text-gray-700 hover:bg-gray-100"
            >
              Cancel
            </button>
            <button
              type="button"
              id="confirmDeleteBtn"
              class="px-4 py-2 bg-danger hover:bg-red-700 text-white rounded-lg"
            >
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Success Notification -->
    <div
      id="successNotification"
      class="fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg shadow-lg hidden z-50"
    >
      <div class="flex items-center">
        <i class="fas fa-check-circle text-green-500 mr-2"></i>
        <span id="successMessage">Operation completed successfully!</span>
        <button
          id="closeSuccess"
          class="ml-4 text-green-700 hover:text-green-900"
        >
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <!-- Error Notification -->
    <div
      id="errorNotification"
      class="fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-lg hidden z-50"
    >
      <div class="flex items-center">
        <i class="fas fa-exclamation-circle text-red-500 mr-2"></i>
        <span id="errorMessage">An error occurred. Please try again.</span>
        <button id="closeError" class="ml-4 text-red-700 hover:text-red-900">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Global variables
      let apiKeys = [];
      let currentPage = 1;
      const itemsPerPage = 10;
      let currentEditingId = null;
      let usageChart = null;

      // DOM Elements
      const toggleSidebarBtn = document.getElementById("toggleSidebar");
      const sidebar = document.querySelector(".sidebar");
      const content = document.querySelector(".content");
      const apiKeysTable = document.getElementById("apiKeysTable");
      const totalKeysElement = document.getElementById("totalKeys");
      const activeKeysElement = document.getElementById("activeKeys");
      const suspendedKeysElement = document.getElementById("suspendedKeys");
      const totalRequestsElement = document.getElementById("totalRequests");
      const addKeyBtn = document.getElementById("addKeyBtn");
      const apiKeyModal = document.getElementById("apiKeyModal");
      const closeModalBtn = document.getElementById("closeModal");
      const cancelBtn = document.getElementById("cancelBtn");
      const apiKeyForm = document.getElementById("apiKeyForm");
      const modalTitle = document.getElementById("modalTitle");
      const submitBtnText = document.getElementById("submitBtnText");
      const deleteModal = document.getElementById("deleteModal");
      const closeDeleteModalBtn = document.getElementById("closeDeleteModal");
      const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");
      const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");
      const successNotification = document.getElementById(
        "successNotification"
      );
      const errorNotification = document.getElementById("errorNotification");
      const closeSuccessBtn = document.getElementById("closeSuccess");
      const closeErrorBtn = document.getElementById("closeError");
      const prevPageBtn = document.getElementById("prevPage");
      const nextPageBtn = document.getElementById("nextPage");
      const startItemElement = document.getElementById("startItem");
      const endItemElement = document.getElementById("endItem");
      const totalItemsElement = document.getElementById("totalItems");
      const timeRangeSelect = document.getElementById("timeRange");
      const copyKeyBtn = document.getElementById("copyKey");
      const apiKeyField = document.getElementById("apiKeyField");

      // Initialize the application
      document.addEventListener("DOMContentLoaded", function () {
        // Load API keys
        fetchAPIKeys();

        // Set up event listeners
        setupEventListeners();
      });

      // Set up all event listeners
      function setupEventListeners() {
        // Sidebar toggle
        toggleSidebarBtn.addEventListener("click", toggleSidebar);

        // Modal controls
        addKeyBtn.addEventListener("click", showAddModal);
        closeModalBtn.addEventListener("click", hideModal);
        cancelBtn.addEventListener("click", hideModal);
        apiKeyForm.addEventListener("submit", handleFormSubmit);

        // Delete modal controls
        closeDeleteModalBtn.addEventListener("click", hideDeleteModal);
        cancelDeleteBtn.addEventListener("click", hideDeleteModal);
        confirmDeleteBtn.addEventListener("click", confirmDelete);

        // Notification controls
        closeSuccessBtn.addEventListener("click", () =>
          successNotification.classList.add("hidden")
        );
        closeErrorBtn.addEventListener("click", () =>
          errorNotification.classList.add("hidden")
        );

        // Pagination
        prevPageBtn.addEventListener("click", goToPrevPage);
        nextPageBtn.addEventListener("click", goToNextPage);

        // Time range selector
        timeRangeSelect.addEventListener("change", updateUsageChart);

        // Copy API key
        copyKeyBtn.addEventListener("click", copyAPIKey);
      }

      // Toggle sidebar collapse
      function toggleSidebar() {
        sidebar.classList.toggle("collapsed");
      }

      // Fetch API keys from the server
      async function fetchAPIKeys() {
        try {
          // Show loading state
          apiKeysTable.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-4 text-center">
                            <div class="flex justify-center items-center space-x-2 text-gray-500">
                                <i class="fas fa-circle-notch loading-spinner"></i>
                                <span>Loading API keys...</span>
                            </div>
                        </td>
                    </tr>
                `;

          // Simulate API call (replace with actual fetch to your endpoint)
          // const response = await fetch('https://galacticbytestudio.com/api/data/apikeys.json');
          // const data = await response.json();

          // Mock data for demonstration
          const data = {
            apiKeys: [
              {
                id: "key_001",
                client: "BetMaster Pro",
                email: "contact@betmaster.com",
                key: "gb_sk_1234567890abcdef1234567890abcdef",
                status: "active",
                created: "2023-05-15",
                usage: {
                  total: 1245,
                  today: 42,
                  last7Days: 320,
                  last30Days: 1245,
                },
              },
              {
                id: "key_002",
                client: "Lucky Spin Casino",
                email: "support@luckyspin.com",
                key: "gb_sk_abcdef1234567890abcdef1234567890",
                status: "active",
                created: "2023-06-22",
                usage: {
                  total: 876,
                  today: 18,
                  last7Days: 210,
                  last30Days: 876,
                },
              },
              {
                id: "key_003",
                client: "Golden Bet",
                email: "info@goldenbet.io",
                key: "gb_sk_7890abcdef1234567890abcdef123456",
                status: "suspended",
                created: "2023-07-10",
                usage: {
                  total: 532,
                  today: 0,
                  last7Days: 0,
                  last30Days: 45,
                },
              },
              {
                id: "key_004",
                client: "Jackpot Kings",
                email: "dev@jackpotkings.net",
                key: "gb_sk_4567890abcdef1234567890abcdef12",
                status: "active",
                created: "2023-08-05",
                usage: {
                  total: 987,
                  today: 36,
                  last7Days: 245,
                  last30Days: 987,
                },
              },
              {
                id: "key_005",
                client: "Fortune Wheel",
                email: "api@fortunewheel.gg",
                key: "gb_sk_90abcdef1234567890abcdef12345678",
                status: "active",
                created: "2023-09-18",
                usage: {
                  total: 654,
                  today: 28,
                  last7Days: 187,
                  last30Days: 654,
                },
              },
            ],
          };

          apiKeys = data.apiKeys;
          renderAPIKeys();
          updateStats();
          initializeUsageChart();

          // Show success notification
          showNotification("API keys loaded successfully", "success");
        } catch (error) {
          console.error("Error fetching API keys:", error);
          showNotification("Failed to load API keys", "error");

          // Show error state
          apiKeysTable.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-4 text-center">
                            <div class="flex flex-col items-center space-y-2 text-gray-500">
                                <i class="fas fa-exclamation-triangle text-2xl text-warning"></i>
                                <span>Failed to load API keys</span>
                                <button class="mt-2 px-3 py-1 bg-primary text-white rounded-lg text-sm" onclick="fetchAPIKeys()">
                                    <i class="fas fa-sync-alt mr-1"></i> Retry
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
        }
      }

      // Render API keys in the table
      function renderAPIKeys() {
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = Math.min(startIndex + itemsPerPage, apiKeys.length);
        const paginatedKeys = apiKeys.slice(startIndex, endIndex);

        let html = "";

        if (paginatedKeys.length === 0) {
          html = `
                    <tr>
                        <td colspan="7" class="px-6 py-4 text-center text-gray-500">
                            No API keys found
                        </td>
                    </tr>
                `;
        } else {
          paginatedKeys.forEach((key) => {
            const statusClass =
              key.status === "active"
                ? "bg-green-100 text-green-800"
                : "bg-yellow-100 text-yellow-800";

            html += `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${
                              key.id
                            }</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">${
                                  key.client
                                }</div>
                                <div class="text-sm text-gray-500">${
                                  key.email
                                }</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900 font-mono">${key.key.substring(
                                  0,
                                  8
                                )}...</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${capitalizeFirstLetter(
              key.status
            )}</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(
                              key.created
                            )}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">${
                                  key.usage.today
                                } today</div>
                                <div class="text-xs text-gray-500">${
                                  key.usage.total
                                } total</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <button onclick="editKey('${
                                  key.id
                                }')" class="text-primary hover:text-indigo-900 mr-3">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="showDeleteModal('${
                                  key.id
                                }')" class="text-danger hover:text-red-900">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                    `;
          });
        }

        apiKeysTable.innerHTML = html;

        // Update pagination info
        startItemElement.textContent = apiKeys.length > 0 ? startIndex + 1 : 0;
        endItemElement.textContent = endIndex;
        totalItemsElement.textContent = apiKeys.length;

        // Update pagination buttons
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = endIndex >= apiKeys.length;
      }

      // Update stats cards
      function updateStats() {
        const total = apiKeys.length;
        const active = apiKeys.filter((key) => key.status === "active").length;
        const suspended = apiKeys.filter(
          (key) => key.status === "suspended"
        ).length;
        const totalRequests = apiKeys.reduce(
          (sum, key) => sum + key.usage.total,
          0
        );

        totalKeysElement.textContent = total;
        activeKeysElement.textContent = active;
        suspendedKeysElement.textContent = suspended;
        totalRequestsElement.textContent = totalRequests;
      }

      // Initialize usage chart
      function initializeUsageChart() {
        const ctx = document.getElementById("usageChart").getContext("2d");

        // Get data for last 30 days
        const days = 30;
        const labels = [];
        const dataPoints = [];

        for (let i = days - 1; i >= 0; i--) {
          const date = new Date();
          date.setDate(date.getDate() - i);
          labels.push(formatChartDate(date));

          // Simulate random data (replace with actual usage data)
          dataPoints.push(Math.floor(Math.random() * 100) + 20);
        }

        usageChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: "API Requests",
                data: dataPoints,
                backgroundColor: "rgba(79, 70, 229, 0.1)",
                borderColor: "rgba(79, 70, 229, 1)",
                borderWidth: 2,
                tension: 0.3,
                fill: true,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                mode: "index",
                intersect: false,
              },
            },
            scales: {
              x: {
                grid: {
                  display: false,
                },
              },
              y: {
                beginAtZero: true,
                grid: {
                  drawBorder: false,
                },
              },
            },
          },
        });
      }

      // Update usage chart based on selected time range
      function updateUsageChart() {
        const days = parseInt(timeRangeSelect.value);
        const labels = [];
        const dataPoints = [];

        for (let i = days - 1; i >= 0; i--) {
          const date = new Date();
          date.setDate(date.getDate() - i);
          labels.push(formatChartDate(date));

          // Simulate random data (replace with actual usage data)
          dataPoints.push(Math.floor(Math.random() * ((100 * days) / 30)) + 20);
        }

        usageChart.data.labels = labels;
        usageChart.data.datasets[0].data = dataPoints;
        usageChart.update();
      }

      // Show add key modal
      function showAddModal() {
        modalTitle.textContent = "Add New API Key";
        submitBtnText.textContent = "Add Key";
        apiKeyForm.reset();
        document.getElementById("keyId").value = "";
        document.getElementById("apiKey").value = generateAPIKey();
        apiKeyField.style.display = "block";
        showModal();
      }

      // Show edit key modal
      function editKey(keyId) {
        const key = apiKeys.find((k) => k.id === keyId);
        if (!key) return;

        modalTitle.textContent = "Edit API Key";
        submitBtnText.textContent = "Update Key";
        document.getElementById("keyId").value = key.id;
        document.getElementById("clientName").value = key.client;
        document.getElementById("clientEmail").value = key.email;
        document.getElementById("keyStatus").value = key.status;
        document.getElementById("apiKey").value = key.key;
        apiKeyField.style.display = "none";
        currentEditingId = keyId;
        showModal();
      }

      // Show modal
      function showModal() {
        apiKeyModal.classList.remove("hidden");
      }

      // Hide modal
      function hideModal() {
        apiKeyModal.classList.add("hidden");
      }

      // Show delete confirmation modal
      function showDeleteModal(keyId) {
        currentEditingId = keyId;
        deleteModal.classList.remove("hidden");
      }

      // Hide delete confirmation modal
      function hideDeleteModal() {
        deleteModal.classList.add("hidden");
      }

      // Handle form submission
      function handleFormSubmit(e) {
        e.preventDefault();

        const id = document.getElementById("keyId").value;
        const client = document.getElementById("clientName").value;
        const email = document.getElementById("clientEmail").value;
        const status = document.getElementById("keyStatus").value;
        const key = document.getElementById("apiKey").value;

        if (id) {
          // Update existing key
          const index = apiKeys.findIndex((k) => k.id === id);
          if (index !== -1) {
            apiKeys[index] = {
              ...apiKeys[index],
              client,
              email,
              status,
            };

            showNotification("API key updated successfully", "success");
          }
        } else {
          // Add new key
          const newKey = {
            id: "key_" + Math.random().toString(36).substring(2, 6),
            client,
            email,
            key,
            status,
            created: new Date().toISOString().split("T")[0],
            usage: {
              total: 0,
              today: 0,
              last7Days: 0,
              last30Days: 0,
            },
          };

          apiKeys.unshift(newKey);
          showNotification("API key added successfully", "success");
        }

        renderAPIKeys();
        updateStats();
        hideModal();
      }

      // Confirm deletion
      function confirmDelete() {
        const index = apiKeys.findIndex((k) => k.id === currentEditingId);
        if (index !== -1) {
          apiKeys.splice(index, 1);
          showNotification("API key deleted successfully", "success");
          renderAPIKeys();
          updateStats();
        }

        hideDeleteModal();
      }

      // Go to previous page
      function goToPrevPage() {
        if (currentPage > 1) {
          currentPage--;
          renderAPIKeys();
        }
      }

      // Go to next page
      function goToNextPage() {
        if (currentPage * itemsPerPage < apiKeys.length) {
          currentPage++;
          renderAPIKeys();
        }
      }

      // Show notification
      function showNotification(message, type) {
        if (type === "success") {
          document.getElementById("successMessage").textContent = message;
          successNotification.classList.remove("hidden");

          // Auto-hide after 5 seconds
          setTimeout(() => {
            successNotification.classList.add("hidden");
          }, 5000);
        } else {
          document.getElementById("errorMessage").textContent = message;
          errorNotification.classList.remove("hidden");

          // Auto-hide after 5 seconds
          setTimeout(() => {
            errorNotification.classList.add("hidden");
          }, 5000);
        }
      }

      // Generate a random API key
      function generateAPIKey() {
        const chars = "0123456789abcdef";
        let result = "gb_sk_";

        for (let i = 0; i < 32; i++) {
          result += chars[Math.floor(Math.random() * chars.length)];
        }

        return result;
      }

      // Copy API key to clipboard
      function copyAPIKey() {
        const apiKeyInput = document.getElementById("apiKey");
        apiKeyInput.select();
        document.execCommand("copy");

        // Show tooltip or change icon temporarily
        const icon = copyKeyBtn.querySelector("i");
        icon.classList.remove("fa-copy");
        icon.classList.add("fa-check");

        setTimeout(() => {
          icon.classList.remove("fa-check");
          icon.classList.add("fa-copy");
        }, 2000);
      }

      // Helper function to capitalize first letter
      function capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
      }

      // Helper function to format date
      function formatDate(dateString) {
        const options = { year: "numeric", month: "short", day: "numeric" };
        return new Date(dateString).toLocaleDateString(undefined, options);
      }

      // Helper function to format date for chart
      function formatChartDate(date) {
        const month = date.toLocaleString("default", { month: "short" });
        const day = date.getDate();
        return `${month} ${day}`;
      }
    </script>
  </body>
</html>
